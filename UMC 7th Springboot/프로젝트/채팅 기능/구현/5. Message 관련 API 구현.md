
## ì±„íŒ… ë©”ì„¸ì§€ ì „ì†¡ API

### 1. WebSocketChatHandler

ê¸°ì¡´ì— ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ë‘ì—ˆë˜ `handleTextMessage`ë¥¼ ì±„íŒ… ë©”ì„¸ì§€ ì „ì†¡ API ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ìˆ˜ì •í•œë‹¤.

Controllerë¥¼ ë”°ë¡œ êµ¬í˜„í•˜ëŠ” ê²Œ ì•„ë‹Œ, Handler ë‚´ `handleTextMessage` ì„¤ì •ì„ í†µí•´ ë©”ì„¸ì§€ ì „ì†¡ APIë¥¼ êµ¬í˜„í•œë‹¤.

WebSocket í†µì‹ ì€ Swaggerì—ì„œ ì§ì ‘ì ìœ¼ë¡œ ì§€ì›í•´ì£¼ì§€ ì•Šì•„ Swaggerë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸ëŠ” ì–´ë µë‹¤.

```java

@Component
@Log4j2
@RequiredArgsConstructor
public class WebSocketChatHandler extends TextWebSocketHandler {

    private final ChatMessageCommandService chatMessageCommandService;
    private final ObjectMapper objectMapper;

		// ... ê¸°ì¡´ ë©”ì„œë“œ ...
		

    // ìƒˆë¡œìš´ WebSocket ë©”ì„¸ì§€ê°€ ë°œìƒí•˜ë©´ ì²˜ë¦¬í•˜ëŠ” ë©”ì„œë“œ
    // = ì±„íŒ… ë©”ì„¸ì§€ ì „ì†¡ API
    @Operation(summary = "WebSocket ì—°ê²° ì•ˆë‚´",
            description = "WebSocketì„ í†µí•´ ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.(WebSocketì€ Swaggerì—ì„œ ì§€ì›í•˜ì§€ ì•Šì•„ swaggerë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸ëŠ” ì–´ë µìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ws://(ë„ë©”ì¸ëª…)/ws/chat ì—”ë“œí¬ì¸íŠ¸ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.")
    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {

        // 1. í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë©”ì„¸ì§€ë¥¼ ìˆ˜ì‹ ë°›ëŠ”ë‹¤.
        String payload = message.getPayload();
        ChatMessageRequestDto.CreateChatMessageDto requestDto =
                objectMapper.readValue(payload, ChatMessageRequestDto.CreateChatMessageDto.class);

            // payloadë¥¼ ë¡œê·¸ ë©”ì„¸ì§€ë¡œ ì¶œë ¥í•œë‹¤.
        log.info("payload {}", payload);

        // 2. ë©”ì„¸ì§€ë¥¼ ì²˜ë¦¬í•œë‹¤.
            // service ë¡œì§ì„ í†µí•˜ì—¬ ë©”ì„¸ì§€ë¥¼ ì €ì¥í•œë‹¤.
            // ì±„íŒ…ë°©ì´ ì—†ëŠ” ê²½ìš° ì±„íŒ…ë°©ì„ ìƒì„±í•œë‹¤.(ì²« ë©”ì‹œì§€ì˜ ê²½ìš°ê°€ ì—¬ê¸°ì— í•´ë‹¹í•œë‹¤.)
        ChatMessage savedChatMessage = chatMessageCommandService.processMessage(requestDto);

        // 3. ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ìƒì„±í•œë‹¤.
        TextMessage responseMessage = ChatMessageConverter.toTextMessage(savedChatMessage);

        // 4. í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µì„ ì „ì†¡í•œë‹¤.
            // ì„¸ì…˜ê°’ë“¤ì„ ë°˜ë³µë¬¸ìœ¼ë¡œ ìˆœíšŒí•˜ê³ , ë™ì¼í•œ ì•„ì´ë””ê°€ ì•„ë‹ˆë©´ ë©”ì‹œì§€ë¥¼ ë°œì‹ í•œë‹¤.
        clientSessions.forEach((key, value) -> {
            log.info("key :: {}  value :: {}", key, value);       // key-value í™•ì¸ìš© ë¡œê·¸

            if (!key.equals(session.getId())) {  // í˜„ì¬ ì„¸ì…˜ê³¼ ë‹¤ë¥¸ ì„¸ì…˜ì—ë§Œ ë©”ì‹œì§€ ì „ì†¡ (í˜„ì¬ ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í´ë¼ì´ì–¸íŠ¸ë“¤ì—ê²Œë§Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡)
                try {
                    // ì„¸ì…˜ì´ ì—´ë ¤ ìˆëŠ”ì§€ í™•ì¸
                    if (value.isOpen()) {
                        value.sendMessage(message);
                    } else {
                        log.warn("ì„¸ì…˜ì´ ë‹«í˜€ ìˆìŠµë‹ˆë‹¤: session Id = {}", key);
                    }
                } catch (IOException e) {
                    log.error("ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜: session Id = {}", key, e);
                }
            }
        });
    }

		// ... ê¸°ì¡´ ë©”ì„œë“œ ...
}

```

- ObjectMapper
    
    - JSON ë°ì´í„° â†” JAVA ê°ì²´ ê°„ì˜ ë³€í™˜ì„ ë‹´ë‹¹í•˜ëŠ” Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ í´ë˜ìŠ¤
    - ìƒì„¸ ê¸°ëŠ¥
        - JSON ë°ì´í„° â†’ JAVA ê°ì²´: `readValue`Â ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ JSON ë¬¸ìì—´ì„ íŠ¹ì • í´ë˜ìŠ¤ì˜ ê°ì²´ë¡œ ë³€í™˜í•œë‹¤. Dto, Entity â€¦ ë“± JAVA ê°ì²´ë©´ ë‹¤ OK.
        - JAVA ê°ì²´ â†’ JSON ë°ì´í„°: `writeValueAsString`Â ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Java ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ì§ë ¬í™”í•œë‹¤.
        - ì˜ˆì™¸ ì²˜ë¦¬ ê°€ëŠ¥: ìœ„ ë‘ ê°€ì§€ ë³€í™˜ ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ì˜ˆì™¸ë¥¼ ì •ì˜í•˜ê³ , ì²˜ë¦¬í•œë‹¤. `JsonMappingException`,Â `JsonProcessingException`Â ë“±ì˜ ì˜ˆì™¸ë¥¼ í†µí•´ ë³€í™˜ ê³¼ì •ì—ì„œì˜ ì˜¤ë¥˜ë¥¼ ê´€ë¦¬í•œë‹¤.
- TextMessage
    
    - WebSocket ì„¸ì…˜ì—ì„œ, í´ë¼ì´ì–¸íŠ¸â€”ì„œë²„ ê°„ì— ì „ì†¡ë˜ëŠ” í…ìŠ¤íŠ¸ ê¸°ë°˜ ë©”ì‹œì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í´ë˜ìŠ¤
    - WebSocket í†µì‹ ì—ì„œ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ë° ìµœì í™”ë˜ì–´ ìˆë‹¤.
    - **ì–´ë–¤ êµ¬ì„±?** ë©”ì‹œì§€ì˜ ë‚´ìš©ì„ ë‹´ê³  ìˆëŠ” ë¬¸ìì—´ í•„ë“œë¥¼ ê°€ì§„ë‹¤.
    - **ì–´ë–»ê²Œ ìƒì„±?** ë¬¸ìì—´ì„ ì¸ìë¡œ ë°›ì•„ì„œ ë©”ì„¸ì§€ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ex) `new TextMessage(â€ì•ˆë…•â€)`
    - **ì–¸ì œ ì‚¬ìš©?** WebSocket í•¸ë“¤ëŸ¬ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ë•Œ ì‚¬ìš©
- handleTextMessage íë¦„
    
    1. ë©”ì„¸ì§€ ìˆ˜ì‹ 
        1. í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„°, ìˆ˜ì‹ í•œ ë©”ì„¸ì§€ì˜ í˜ì´ë¡œë“œë¥¼ ê°€ì ¸ì˜¨ë‹¤.
        2. `ObjectMapper`ë¥¼ ì‚¬ìš©í•˜ì—¬ JSON í˜•ì‹ì˜ ë¬¸ìì—´ì„Â `CreateChatMessageDto`Â ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.
    2. ë©”ì„¸ì§€ ì²˜ë¦¬
        1. ìˆ˜ì‹ í•œ ë©”ì„¸ì§€ë¥¼ ì„œë¹„ìŠ¤ ë¡œì§ì„ í†µí•´ ì €ì¥í•œë‹¤.
        2. ì„œë¹„ìŠ¤(`processMessage`) ë¡œì§: ì±„íŒ…ë°©ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°(=ìƒëŒ€ë°©ì—ê²Œ ì²˜ìŒìœ¼ë¡œ ì±„íŒ…ì„ ë³´ë‚´ëŠ” ê²½ìš°) ìƒˆë¡œìš´ ì±„íŒ…ë°©ì„ ìƒì„±í•œë‹¤.
    3. ì‘ë‹µ ë©”ì„¸ì§€ ìƒì„±
        1. ì €ì¥ëœ ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Response ë©”ì„¸ì§€ë¥¼ ìƒì„±í•œë‹¤.
        2. ì´ ê³¼ì •ì—ì„œë„ `ObjectMapper`ë¥¼ í™œìš©í•˜ì—¬ ê°ì²´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œë‹¤.
    4. í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µ ì „ì†¡
        1. í˜„ì¬ ì„¸ì…˜ì„ ì œì™¸í•œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜(ì¦‰, ë‚˜ ìì‹ ì„ ì œì™¸í•œ ìƒëŒ€ë°© ì„¸ì…˜. ìš°ë¦¬ëŠ” 1:1 ì„œë¹„ìŠ¤ë‹ˆ ìƒëŒ€ë°©ì—ê²Œë§Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤ê³  ë³´ë©´ ëœë‹¤.)ì— ëŒ€í•´ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤.
        2. ê° ì„¸ì…˜ì´ ì—´ë ¤ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—´ë ¤ ìˆë‹¤ë©´ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
- handlerì— `@Valid`ë¥¼ ë¶™ì¼ ìˆ˜ëŠ” ì—†ì–´ì„œ, ì„œë¹„ìŠ¤ ë©”ì†Œë“œì˜ dto ë§¤ê°œë³€ìˆ˜ì— `@Valid`ë¥¼ ë¶™ì—¬ì„œ ì‚¬ìš©
    

### 2. Dto

- ChatMessageRequestDto
    
    ```java
    public class ChatMessageRequestDto {
    
        @Builder
        @Getter
        @AllArgsConstructor
        @NoArgsConstructor
        public static class CreateChatMessageDto {
    		    @NotNull
            private Long senderId;
            @NotNull
            private Long receiverId;
            @NotNull
            private Long postId;
            @NotBlank
            private String content;
        }
    }
    ```
    
- ChatMessageResponseDto
    
    ```java
    public class ChatMessageResponseDto {
    
        @Builder
        @Getter
        @NoArgsConstructor
        @AllArgsConstructor
        public static class ChatMessageDto {
            private String id;
            private Long chatRoomId;
            private Long senderId;
            private Long receiverId;
            private String content;
            @JsonSerialize(using = LocalDateTimeSerializer.class)  // ì»¤ìŠ¤í…€ ì§ë ¬í™”ê¸° ì‚¬ìš©
            private LocalDateTime createdAt;
        }
    }
    ```
    

### 3. Service

- ChatMessageCommandServiceImpl
    
    ```java
    @Service
    @RequiredArgsConstructor
    public class ChatMessageCommandServiceImpl implements ChatMessageCommandService {
    
        private final ChatRoomRepository chatRoomRepository;
        private final ChatMessageRepository chatMessageRepository;
        private final ChatRoomCommandService chatRoomCommandService;
    
        @Override
        @Transactional
        public ChatMessage processMessage(ChatMessageRequestDto.@Valid CreateChatMessageDto request){
            // 1. ì±„íŒ…ë°©ì´ ìˆëŠ”ì§€ ì¡°íšŒí•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±í•œë‹¤.
            ChatRoom chatRoom = chatRoomRepository.findByPostIdAndOtherMemberId(request.getPostId(), request.getReceiverId())
                    .or(() -> chatRoomRepository.findByPostIdAndOtherMemberId(request.getPostId(), request.getSenderId()))
                    .orElseGet(() -> {
                        ChatRoom newChatRoom = ChatRoomConverter.toChatRoom(request);
                        return chatRoomRepository.save(newChatRoom); // ì±„íŒ…ë°© ìƒì„± í›„ DBì— ì €ì¥
                    });
    
            // 2. ë©”ì„¸ì§€ë¥¼ MongoDBì— ì €ì¥í•œë‹¤.
            ChatMessage newChatMessage = ChatMessageConverter.toChatMessage(request, chatRoom);
            return chatMessageRepository.save(newChatMessage);
        }
    
    }
    
    ```
    
    - ì±„íŒ…ë°© ì¡°íšŒ ë° ìƒì„± ë³€ì²œì‚¬
        
        1. ì´ˆê¸° ë²„ì „
            
            - ChatMessageCommandServiceImpl
                
                ```java
                // 1. ì±„íŒ…ë°©ì´ ìˆëŠ”ì§€ ì¡°íšŒí•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±í•œë‹¤.
                ChatRoom chatRoom = chatRoomRepository.findByPostIdAndMembers(
                                request.getPostId(),
                                request.getReceiverId())
                       .orElseGet(() -> chatRoomCommandService.createChatRoom(request));
                ```
                
            - ChatRoomRepository
                
                ```java
                @Repository
                public interface ChatRoomRepository extends JpaRepository<ChatRoom, Long> {
                    // ì±„íŒ… ì „ì†¡ ì‹œ ì±„íŒ…ë°©ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
                    Optional<ChatRoom> findByPostIdAndOtherMemberId(Long postId, Long receiverId);
                }
                ```
                
            - ì´ ë°©ì‹ì˜ ë¬¸ì œì : ì˜ë„ì™€ ë‹¤ë¥¸ ê²°ê³¼ë¬¼
                
                - `ChatRoom`ì´ `postId`ì™€ `otherMemberId`ë¡œë§Œ ì¡°íšŒë˜ê³  ìˆì–´ì„œ, ë™ì¼í•œ `postId`ì— ëŒ€í•´ `sender`ì™€ `receiver`ê°€ ë°”ë€Œì—ˆì„ ë•Œ ìƒˆë¡œìš´ `ChatRoom`ì´ ìƒì„±ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ì´ë¡œ ì¸í•´ `chatRoomId`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°íšŒë˜ëŠ” ì±„íŒ… ë‚´ì—­ë„ í•œ ì‚¬ëŒì˜ ê²ƒë§Œ ì¡°íšŒëœë‹¤ëŠ” ë¬¸ì œê°€ ìƒê¸´ë‹¤. (ì„œë¹„ìŠ¤ì— ê²°í•¨ì´ ìƒê¸´ë‹¤.)
        2. ë‘ ë²ˆì§¸ ë²„ì „
            
            - ì´ˆê¸° ë²„ì „ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ì»¤ìŠ¤í…€í•˜ì—¬ ìˆ˜ì •í•˜ì˜€ë‹¤.
        
        - ChatMessageCommandServiceImpl
            
            ```java
            // 1. ì±„íŒ…ë°©ì´ ìˆëŠ”ì§€ ì¡°íšŒí•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±í•œë‹¤.
            ChatRoom chatRoom = chatRoomRepository.findByPostIdAndOtherMemberId(request.getPostId(), request.getSenderId(), request.getReceiverId())
                    .or(() -> chatRoomRepository.findByPostIdAndOtherMemberId(request.getPostId(), request.getSenderId(), request.getReceiverId()))
                    .orElseGet(() -> {
                        ChatRoom newChatRoom = ChatRoomConverter.toChatRoom(request);
                        return chatRoomRepository.save(newChatRoom); // ìƒì„± í›„ ì €ì¥
                    });
            ```
            
        - ChatRoomRepository
            
            ```java
            @Repository
            public interface ChatRoomRepository extends JpaRepository<ChatRoom, Long> {
                // ì±„íŒ… ì „ì†¡ ì‹œ ì±„íŒ…ë°©ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
                Optional<ChatRoom> findByPostIdAndOtherMemberId(Long postId, Long otherMemberId);
            }
            ```
            
- ChatRoomCommandServiceImpl
    
    ```java
    @Service
    @RequiredArgsConstructor
    public class ChatRoomsCommandServiceImpl implements ChatRoomCommandService {
    
        private final ChatRoomRepository chatRoomRepository;
    
        // ì±„íŒ… ìƒì„± ì‹œ, ì±„íŒ…ë°©ì´ ìˆëŠ”ì§€ ì¡°íšŒí•˜ê³ , ì—†ìœ¼ë©´ ì±„íŒ…ë°©ì„ ìƒì„±í•˜ê¸° ìœ„í•œ ChatMessageCommandServiceì— ì‚¬ìš©ëœë‹¤.
        @Override
        @Transactional
        public ChatRoom createChatRoom(ChatMessageRequestDto.CreateChatMessageDto request) {
            
            // ìš”ì²­ ë°ì´í„°ì˜ í•„ë“œê°€ ìœ íš¨í•œì§€ í™•ì¸í•œë‹¤.
            Member receivedMember = memberRepository.findById(request.getReceiverId())
                    .orElseThrow(() -> new MemberException(ErrorStatus.MEMBER_NOT_FOUND));
    
            Member sendingMember = memberRepository.findById(request.getSenderId())
                    .orElseThrow(() -> new MemberException(ErrorStatus.MEMBER_NOT_FOUND));
    
            Post post = postRepository.findById(request.getPostId())
                    .orElseThrow(() -> new PostException(ErrorStatus.POST_NOT_FOUND));
            
            // ì±„íŒ…ë°©ì„ ìƒì„±í•œë‹¤.
            ChatRoom newChatRoom = ChatRoomConverter.toChatRoom(request);
            return chatRoomRepository.save(newChatRoom);
        }
    }
    ```
    

### 4. Repository

- ChatRoomRepository
    
    ```java
    @Repository
    public interface ChatRoomRepository extends JpaRepository<ChatRoom, Long> {
        // ì±„íŒ… ì „ì†¡ ì‹œ ì±„íŒ…ë°©ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
        Optional<ChatRoom> findByPostIdAndOtherMemberId(Long postId, Long otherMemberId);   
    }
    ```
    

### 5. Converter

- ChatMessageConverter
    
    ```java
    @Component
    public class ChatMessageConverter {
    
        private static final ObjectMapper objectMapper = new ObjectMapper();
    
    		// ì±„íŒ… ë©”ì„¸ì§€ ê°ì²´ ìƒì„±
        public static ChatMessage toChatMessage(ChatMessageRequestDto.@Valid CreateChatMessageDto request, ChatRoom chatRoom) {
            return ChatMessage.builder()
                    .chatRoomId(chatRoom.getId())
                    .senderId(request.getSenderId())
                    .receiverId(request.getReceiverId())
                    .content(request.getContent())
                    .createdAt(LocalDateTime.now())
                    .build();
        }
    
    		// ì±„íŒ… ë©”ì„¸ì§€ DTO ìƒì„±
        public static ChatMessageResponseDto.ChatMessageDto toChatMessageDto(ChatMessage chatMessage) {
            return ChatMessageResponseDto.ChatMessageDto.builder()
                    .id(chatMessage.getId())
                    .chatRoomId(chatMessage.getChatRoomId())
                    .senderId(chatMessage.getSenderId())
                    .receiverId(chatMessage.getReceiverId())
                    .content(chatMessage.getContent())
                    .createdAt(chatMessage.getCreatedAt())
                    .build();
        }
    
        // í†µì‹  ì‘ë‹µ ë©”ì„¸ì§€ ìƒì„±
        public static TextMessage toTextMessage(ChatMessage chatMessage) {
            try {
                // DTO ìƒì„±
                ChatMessageResponseDto.ChatMessageDto response = toChatMessageDto(chatMessage);
    
                // JSON ë³€í™˜ ë° TextMessage ìƒì„±
                String responseJson = objectMapper.writeValueAsString(response);
                return new TextMessage(responseJson);
    
                // ì—ëŸ¬ì¼€ì´ìŠ¤ì— ë§ëŠ” ì»¤ìŠ¤í…€ ì˜ˆì™¸ì²˜ë¦¬ ì§„í–‰
            } catch (JsonMappingException e) {
                throw new ChatMessageException(ErrorStatus.INVALID_JSON_FORMAT);
            } catch (JsonProcessingException e) {
                throw new ChatMessageException(ErrorStatus.JSON_CONVERSION_FAILED);
            } catch (Exception e) {
                throw new ChatMessageException(ErrorStatus.JSON_PROCESSING_ERROR);
            }
        }
    
    }
    
    ```
    
    - toTextMessage íë¦„
        1. ì‘ë‹µ DTO ìƒ
        2. DTO ê°ì²´ â†’ JSON ë³€í™˜
            1. `ObjectMapper`ì˜Â `writeValueAsString`Â ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Java ê°ì²´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ì§ë ¬í™”
        3. TextMessage ìƒì„±
            1. ë³€í™˜ëœ JSON ë¬¸ìì—´ì„ ê¸°ë°˜ìœ¼ë¡œÂ `TextMessage`Â ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤.
            2. ì´ ê°ì²´ëŠ” WebSocketì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡ë  ë©”ì‹œì§€ì´ë‹¤.
        4. ì˜ˆì™¸ ì²˜ë¦¬
            1. ChatMessageExceptionì„ ì»¤ìŠ¤í…€í•˜ì—¬ êµ¬í˜„í–ˆë‹¤.
            2. JsonMappingException: JSON í˜•ì‹ì´ ì˜ëª»ëœ ê²½ìš°
            3. JsonProcessingException: JSON ë³€í™˜ ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•œ ê²½ìš°
            4. ê¸°íƒ€ ì˜ˆì™¸
- ChatRoomConverter
    
    ```java
    @Component
    public class ChatRoomConverter {
    
        public static ChatRoom toChatRoom(ChatMessageRequestDto.CreateChatMessageDto request) {
            return ChatRoom.builder()
                    .postId(request.getPostId())
                    .otherMemberId(request.getReceiverId())
                    .hasMatched(false)                    // ì±„íŒ…ë°©ì´ ì²˜ìŒ ìƒì„±ëœ ì‹œì ì—ëŠ” ë°˜ë“œì‹œ ë§¤ì¹­ ì „ì´ë‹¤.
                    .hasSenderReviewDone(false)           // ì±„íŒ…ë°©ì´ ì²˜ìŒ ìƒì„±ëœ ì‹œì ì—ëŠ” ë°˜ë“œì‹œ ë§¤ì¹­ ì „ì´ë¯€ë¡œ ë¦¬ë·° ë˜í•œ ì—†ë‹¤.
                    .hasReceiverReviewDone(false)
                    .build();
        }
    }
    ```
    

### í…ŒìŠ¤íŠ¸

URL: `ws://localhost:8080/ws/chat`

1. POSTMAN
    
    - WebSocket í†µì‹  ì„ íƒ
        
    - URL ê¸°ì…í•˜ê³  connect ë²„íŠ¼ í´ë¦­ â†’ â€œConnected to ws://localhost:8080/ws/chatâ€ ë¬¸êµ¬ì™€ WebSocket ì—°ê²° ì™„ë£Œë¼ê³  ëœ¨ëŠ”ì§€ í™•ì¸
        
    - ìœ„ì™€ ë™ì¼í•œ ì°½ì„ í•˜ë‚˜ ë” ë§Œë“¤ê³ , ë§ˆì°¬ê°€ì§€ë¡œ connect ë²„íŠ¼ í´ë¦­ â†’ ë™ì¼í•˜ê²Œ, â€œConnected to ws://localhost:8080/ws/chatâ€ ë¬¸êµ¬ì™€ WebSocket ì—°ê²° ì™„ë£Œë¼ê³  ëœ¨ëŠ”ì§€ í™•ì¸
        
    - ë‘˜ ë‹¤ ì—°ê²°ì´ ë˜ì—ˆìœ¼ë©´, ë‘˜ ì¤‘ ì•„ë¬´ ì°½ì—ì„œ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ Messageë¥¼ ì‘ì„±í•œë‹¤
        
        ```json
        {
        "senderId": 2,
        "receiverId": 1,
        "postId": 1,
        "content": "ì•ˆë…•í•˜ì„¸ìš”! ë©”ì„¸ì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤."
        }
        ```
        
	*  ì•„ë˜ì™€ ê°™ì´ ëœ¨ë©´ ì„±ê³µ (ìˆœì„œëŒ€ë¡œ ë³´ë‚¸ ìª½, ë°›ì€ ìª½)
		![[Pasted image 20250209211349.png]]
		![[Pasted image 20250209211414.png]]
		
        
    - disconnection ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ê°€ ë‚¨ê²¨ì§„ë‹¤.
        
        ```json
        2025-02-07T21:23:57.032+09:00  INFO 6799 --- [nio-8080-exec-5] u.d.g.websocket.WebSocketChatHandler     : WebSocket ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. session Id: a473fa4b-ab02-78be-4d7d-a1bc41fc7927
        ```
        
2. MySQLì— ì±„íŒ…ë°© ë°ì´í„°, MongoDBì— ì±„íŒ… ë©”ì„¸ì§€ ë°ì´í„°ê°€ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
    




---





## íŠ¹ì • ì±„íŒ…ë°©ì˜ ë©”ì„¸ì§€ ì¡°íšŒ API

ì±„íŒ…ì„ í•œ ë²ˆì— ëª¨ë‘ ì¡°íšŒí•´ì˜¤ëŠ” ê²ƒì€ ìì› ë‚­ë¹„ê°€ ì‹¬í•˜ê³ , ë¹„íš¨ìœ¨ì ì´ë‹¤.

ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ë” ìœ„ë¡œ ìŠ¤í¬ë¡¤ í•  ë•Œë§ˆë‹¤ ê³¼ê±° ì±„íŒ… ì´ë ¥ì„ ì¶”ê°€ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹(ë¬´í•œìŠ¤í¬ë¡¤)ìœ¼ë¡œ êµ¬í˜„í•˜ê³ ì í•œë‹¤.

### ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„ ë°©ì‹

- í˜ì´ì§€ë„¤ì´ì…˜ ë°©ì‹
    
    - Offset ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜
        - pageì˜ size ì— í•´ë‹¹í•˜ëŠ” í–‰ë§Œí¼ ë°ì´í„°ë¥¼ ì½ì–´ë“¤ì¸ í›„, ë‹¤ì‹œ pageSize ë§Œí¼ì˜ í–‰ì„ ì½ê³  ì•ì— ì½ì€ í–‰ì„ ì‚­ì œí•œë‹¤.
        - ë’· ë¶€ë¶„ì˜ ë°ì´í„°ë¥¼ ì½ì„ ë•Œë„, ì•ì—ì„œë¶€í„° ì½ê¸°&ì¡°íšŒ&ì‚­ì œê°€ ì§„í–‰ëœë‹¤. ë”°ë¼ì„œ í˜ì´ì§€ ìˆ˜ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì‘ë‹µì‹œê°„ì´ ëŠë ¤ì§„ë‹¤.
    - No Offset ê¸°ë°˜(ì»¤ì„œ ê¸°ë°˜) í˜ì´ì§€ë„¤ì´ì…˜
        - ë§ˆì§€ë§‰ìœ¼ë¡œ ì¡°íšŒëœ í–‰ì˜ idê°’(=ì»¤ì„œ)ì„ ê¸°ì¤€ìœ¼ë¡œ, ì½ì§€ ì•Šì€ í–‰ì„ sizeë§Œí¼ ì¡°íšŒí•œë‹¤.
        - idë¼ëŠ” í´ëŸ¬ìŠ¤í„° ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, ì‹œì‘ì´ ë˜ëŠ” ê¸°ì¤€ì ì„ ì°¾ê¸°ê°€ ë¹ ë¥´ë‹¤. â†’ ì†ë„ê°€ ë¹ ë¥´ë‹¤.
- í˜ì´ì§•ì„ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë‘ ê°€ì§€ ì£¼ìš” ë°˜í™˜ íƒ€ì…: `Page` vs `Slice`
    
    - ë‘˜ ë‹¤ Spring Data JPA, Spring Data MongoDB ë“±ì—ì„œ ì œê³µí•´ì¤€ë‹¤. ë”°ë¼ì„œ MongoDBì˜ ë°ì´í„°ì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    - `Page`
        - í˜ì´ì§• ì²˜ë¦¬ ê²°ê³¼ + ì¶”ê°€ ë©”íƒ€ë°ì´í„° ì œê³µ
            - ì¶”ê°€ ë©”íƒ€ë°ì´í„°:
                - ì´ ë°ì´í„° ê°œìˆ˜
                - ì´ í˜ì´ì§€ ìˆ˜
                - í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
                - ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
                - ì´ì „ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€
    - `Slice`
        - í˜ì´ì§• ì²˜ë¦¬ ê²°ê³¼ + **ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ë§Œ ì œê³µ**
        - Pageì—ì„œ ì œê³µí•˜ëŠ” ë©”íƒ€ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•œ ì—°ì‚°ì´ í•„ìš”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë” ë¹ ë¥´ë‹¤.

<aside> ğŸ“Œ

No Offset ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ì„ Sliceë¡œ êµ¬í˜„í•œë‹¤.

</aside>

### 1. ChatMessageWebSocketController

```java
@RestController
@RequestMapping("/chat")
@RequiredArgsConstructor
public class ChatMessageWebSocketController {

    private final ChatMessageQueryService chatMessageQueryService;

    @GetMapping("/{chatRoomId}/messages")
    @Operation(summary = "íŠ¹ì • ì±„íŒ…ë°© ë‚´ ì±„íŒ… ì¡°íšŒ API", description = "ì±„íŒ…ë°© ë‚´ ì±„íŒ…ì„ 20ê°œì”© ì¡°íšŒí•©ë‹ˆë‹¤. ë¬´í•œ ìŠ¤í¬ë¡¤ ë°©ì‹ìœ¼ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.")
    @Parameters({@Parameter(name = "chatRoomId", description = "ì¡°íšŒí•  ì±„íŒ…ë°© Id, path variable ì…ë‹ˆë‹¤!"),
                   @Parameter(name = "lastMessageId", description = "ì²˜ìŒ ì¡°íšŒ ì‹œì—ëŠ” ì…ë ¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¬´í•œ ìŠ¤í¬ë¡¤ ì‹œ, ì²« ì¡°íšŒì˜ Response Bodyì— ìˆëŠ” lastMessageIdë¥¼ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.")})
    public ApiResponse<ChatMessageResponseDto.ChatMessageListDto> getChatMessagesByChatRoom(
            @PathVariable("chatRoomId") Long chatRoomId,
            @RequestParam(required = false) String lastMessageId,
            @RequestParam(defaultValue = "20") int size) {

        Slice<ChatMessage> chatMessageList = chatMessageQueryService.getChatMessageListByChatRoom(chatRoomId, lastMessageId, size);

        return ApiResponse.onSuccess(ChatMessageConverter.toChatMessageListDto(chatMessageList));
    }
}
```

- ìˆ˜í¬ë‹˜ í†µì¼ ë°©í–¥ì— ë§ì¶° ì»¨íŠ¸ë¡¤ëŸ¬ì— `@Parameters({@Parameter(name = "", description = "")})` ì‚¬ìš©í•˜ì˜€ë‹¤.

### 2. ResponseDto

```java
    @Builder
    @Getter
    @NoArgsConstructor
    @AllArgsConstructor
    public static class ChatMessageListDto {
        private List<ChatMessageDto> chatMessageList;
        private boolean hasNext;
        private String lastMessageId;  // ë§ˆì§€ë§‰ ë©”ì‹œì§€ ID (ë‹¤ìŒ í˜ì´ì§€ ì¡°íšŒì‹œ ì»¤ì„œë¡œ ì‚¬ìš©)
    }
```

- `private List<ChatMessageDto> chatMessageList`
    
    - ì±„íŒ… ë©”ì„¸ì§€ ì „ì†¡ API êµ¬í˜„ ì‹œ êµ¬í˜„í•˜ì˜€ë˜ ChatMessageDtoë¥¼ ì¬ì‚¬ìš©í–ˆë‹¤.
- RequestDtoëŠ” ë³„ë„ë¡œ ë§Œë“¤ì§€ ì•Šì•˜ë‹¤.
    

### 3. ServiceImpl

```java
@Service
@RequiredArgsConstructor
public class ChatMessageQueryServiceImpl implements ChatMessageQueryService {

    private final ChatMessageRepository chatMessageRepository;
    private final MongoTemplate mongoTemplate; // QueryDSL ëŒ€ì²´ë¡œ ì‚¬ìš©

    @Override
    public Slice<ChatMessage> getChatMessageListByChatRoom(Long chatRoomId, String lastMessageId, int size) {
        // MongoDB ë°ì´í„° ì¡°íšŒ
        List<ChatMessage> chatMessageList = fetchMessages(chatRoomId, lastMessageId, size);

        // ë‹¤ìŒ í˜ì´ì§€ ì—¬ë¶€ ê³„ì‚°
        boolean hasNext = hasNextPage(chatMessageList, size);

        // Slice ê°ì²´ ë°˜í™˜
        return new SliceImpl<>(chatMessageList, PageRequest.of(0, size), hasNext);
    }

    private List<ChatMessage> fetchMessages(Long chatRoomId, String lastMessageId, int size) {
        // ì»¤ì„œ ê¸°ë°˜ ì¡°íšŒë¥¼ ìœ„í•œ ì¡°ê±´ ì„¤ì •
        Criteria criteria = Criteria.where("chatRoomId").is(chatRoomId);

        // ì»¤ì„œê°€ ì¡´ì¬í•˜ë©´ lastMessageIdë³´ë‹¤ ì‘ì€ _idë§Œ ì¡°íšŒ
        if (lastMessageId != null) {
            criteria = criteria.and("_id").lt(new ObjectId(lastMessageId));
        }

        Query query = new Query(criteria)
                .with(Sort.by(Sort.Direction.DESC, "createdAt")) // ìµœì‹ ìˆœ ì •ë ¬
                .limit(size + 1); // í˜ì´ì§€ í¬ê¸°ë³´ë‹¤ 1ê°œ ë” ê°€ì ¸ì™€ì„œ hasNext íŒë‹¨

        return mongoTemplate.find(query, ChatMessage.class);
    }

    private boolean hasNextPage(List<ChatMessage> messages, int pageSize) {
        if (messages.size() > pageSize) {
            messages.remove(pageSize); // ì´ˆê³¼ ë°ì´í„° ì œê±°
            return true;
        }
        return false;
    }
}
```

- MongoTemplate
    
    - MongoDBì— ìˆì–´, ë³´ë‹¤ ì„¸ë°€í•œ ì¿¼ë¦¬ ì‘ì„±ì´ í•„ìš”í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë„êµ¬
    - Repositoryì—ì„œ ì œê³µí•˜ëŠ” ë©”ì„œë“œë“¤ë³´ë‹¤ ë” ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
    - MongoDB ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ì™€ ê°€ì¥ ìœ ì‚¬í•œ í˜•íƒœë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
    - JPAì˜ EntityManagerì™€ ë¹„ìŠ·í•œ ì—­í• ì´ë¼ê³  ë³´ë©´ ëœë‹¤.
- QueryDSLì„ í†µí•´ êµ¬í˜„ë„ ê°€ëŠ¥í•˜ì§€ë§Œ,
    
    - QueryDSL ì´ˆê¸° ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.
    - MongoDBì™€ì˜ í˜¸í™˜ì„± ë¬¸ì œê°€ ìˆê³ , MongoDBì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ì§€ì›í•´ì£¼ì§€ëŠ” ì•ŠëŠ”ë‹¤.
    
    ê³  í•˜ì—¬ MongoTemplateìœ¼ë¡œ ì‘ì„±í•˜ì˜€ë‹¤.
    
- ë°ì´í„° ì¡°íšŒì¸ë° ì™œ Repositoryì— ìœ„ì¹˜í•˜ì§€ ì•ŠëŠ”ê°€?
    
    - Queryì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ê²°í•©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
        - ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§•
        - ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ ê³„ì‚°
        - ê²°ê³¼ ê°€ê³µ
- MongoTemplate ì‚¬ìš©ì²˜
    
    ```java
    Query query = new Query(criteria)
        .with(Sort.by(Sort.Direction.DESC, "createdAt"))
        .limit(size + 1);
    ```
    
    - ì£¼ìš” ë©”ì„œë“œ
        - find(): ì¡°íšŒ
        - insert(): ì‚½ì…
        - update(): ìˆ˜ì •
        - remove(): ì‚­ì œ
        - aggregate(): ì§‘ê³„
- Slice
    
    - í˜ì´ì§• ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ë‹´ëŠ” ì»¨í…Œì´ë„ˆë¡œ, ë°ì´í„°ë“¤+ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.
- `fetchMessages` ë©”ì„œë“œ
    
    - Criteria
        
        - MongoDBì˜ ì¡°ê±´ì ˆì„ í‘œí˜„í•˜ëŠ” ë¹Œë”
            
        - SQL WHERE ì ˆê³¼ ë¹„ìŠ·í•œ ì—­í• ì´ë¼ê³  ë³´ë©´ ëœë‹¤.
            
        - ë©”ì„œë“œ ì²´ì´ë‹ì„ í†µí•´ ì¡°ê±´ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
            
        - ì£¼ìš” ë©”ì„œë“œ
            
            - is(): ê°™ìŒ
            - ne(): ê°™ì§€ ì•ŠìŒ
            - gt/lt(): í¬ë‹¤/ì‘ë‹¤
            - gte/lte(): í¬ê±°ë‚˜ ê°™ë‹¤/ì‘ê±°ë‚˜ ê°™ë‹¤
            - in(): í¬í•¨
            - regex(): ì •ê·œì‹
        - MongoDB ì¿¼ë¦¬ â†’ Criteria í‘œí˜„ ì˜ˆì‹œ
            
            ```java
            // MongoDB ì¿¼ë¦¬
            { 
                chatRoomId: 123,
                _id: { $lt: ObjectId("...") }
            }
            
            // Criteriaë¡œ í‘œí˜„
            Criteria.where("chatRoomId").is(123)
                   .and("_id").lt(new ObjectId("..."))
            
            ```
            
    - ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• êµ¬í˜„:
        
        - lastMessageIdë³´ë‹¤ ì‘ì€ IDë¥¼ ê°€ì§„ ë©”ì‹œì§€(=lastMessageIdì— í•´ë‹¹í•˜ëŠ” ë©”ì„¸ì§€ê°€ ì „ì†¡ëœ ì‹œì  ê·¸ ì „ì— ì „ì†¡ëœ ë©”ì„¸ì§€ë“¤)ë§Œ ì¡°íšŒí•œë‹¤.
        - ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì¼ê´€ëœ ê²°ê³¼ë¥¼ ë³´ì¥í•œë‹¤.
- `hasNextPage` ë©”ì„œë“œ
    
    - size + 1ê°œë¥¼ ì¡°íšŒí•˜ì—¬ ë‹¤ìŒ ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
    - ì‹¤ì œ í•„ìš”í•œ sizeë§Œí¼ë§Œ ë°˜í™˜í•˜ê³ , ë°ì´í„° ì¡´ì¬ í™•ì¸ìš©ìœ¼ë¡œ í•˜ë‚˜ ë” ê°€ì ¸ì˜¨ ì´ˆê³¼ë¶„ì€ ì œê±°í•œë‹¤.

### 4. Converter

ê¸°ì¡´ ChatMessageConverterì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.

```java
    // íŠ¹ì • ì±„íŒ…ë°© ë‚´ ì±„íŒ… ë©”ì‹œì§€ ì¡°íšŒ ê²°ê³¼ DTO ìƒì„±
    public static ChatMessageResponseDto.ChatMessageListDto toChatMessageListDto(Slice<ChatMessage> chatMessageSlice) {
        // Sliceì˜ ì½˜í…ì¸ (ChatMessage)ë¥¼ ChatMessageDtoë¡œ ë³€í™˜
        List<ChatMessageResponseDto.ChatMessageDto> chatMessageDtoList = chatMessageSlice.getContent().stream()
                .map(ChatMessageConverter::toChatMessageDto)
                .collect(Collectors.toList());

        // hasNextëŠ” Sliceì—ì„œ ì œê³µí•˜ëŠ” ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        boolean hasNext = chatMessageSlice.hasNext();

        // ë§ˆì§€ë§‰ ë©”ì‹œì§€ì˜ ID ì¶”ì¶œ (ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ ìˆì§€ ì•Šì€ ê²½ìš°)
        String lastMessageId = !chatMessageDtoList.isEmpty()
                ? chatMessageDtoList.get(chatMessageDtoList.size() - 1).getId()
                : null;

        // ìµœì¢… ê²°ê³¼ DTO ìƒì„± ë° ë°˜í™˜
        return ChatMessageResponseDto.ChatMessageListDto.builder()
                .chatMessageList(chatMessageDtoList)
                .hasNext(hasNext)
                .lastMessageId(lastMessageId)
                .build();
    }
```

### í…ŒìŠ¤íŠ¸

1. Swaggerì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ ìµœì‹  ìˆœìœ¼ë¡œ **20**ê°œì˜ ë©”ì„¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤. (ì²« ì¡°íšŒ ê°€ëŠ¥í•œì§€ í…ŒìŠ¤íŠ¸)
    
    - Response Body ì „ë¬¸
        
        ```json
        {
          "isSuccess": true,
          "code": "COMMON200",
          "message": "ì„±ê³µì…ë‹ˆë‹¤.",
          "result": {
            "chatMessageList": [
              {
                "id": "67a820c7cc357f618cb9f514",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c7cc357f618cb9f513",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c7cc357f618cb9f512",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c7cc357f618cb9f511",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c6cc357f618cb9f510",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c6cc357f618cb9f50f",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c6cc357f618cb9f50e",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c6cc357f618cb9f50d",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c6cc357f618cb9f50c",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c5cc357f618cb9f50b",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c5cc357f618cb9f50a",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c5cc357f618cb9f509",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c5cc357f618cb9f508",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a820c2cc357f618cb9f507",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë”ë¯¸ë°ì´í„°ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-09 12:28"
              },
              {
                "id": "67a5fb4f40d90b25f00c279c",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "ì•ˆë…•í•˜ì„¸ìš”! ë©”ì„¸ì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.",
                "createdAt": "2025-02-07 21:23"
              },
              {
                "id": "67a5f8c7d846dd0e891c2428",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "ì•ˆë…•í•˜ì„¸ìš”! ì´ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.",
                "createdAt": "2025-02-07 21:12"
              },
              {
                "id": "67a5e90a6afbb772f13ddd0e",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "ì•ˆë…•í•˜ì„¸ìš”! ì´ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.",
                "createdAt": "2025-02-07 20:05"
              },
              {
                "id": "67a5e8e86afbb772f13ddd0c",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "ì•ˆë…•í•˜ì„¸ìš”! ì´ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.",
                "createdAt": "2025-02-07 20:05"
              },
              {
                "id": "67a5e8976afbb772f13ddd0b",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤ì•„ì•„!!",
                "createdAt": "2025-02-07 20:03"
              },
              {
                "id": "67a5e8716afbb772f13ddd0a",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸!!",
                "createdAt": "2025-02-07 20:03"
              }
            ],
            "hasNext": true,
            "lastMessageId": "67a5e8716afbb772f13ddd0a"
          }
        }
        ```
        
2. ì§ì „ í…ŒìŠ¤íŠ¸ì˜ Response Body ì— ìˆëŠ” `lastMessageId`ì˜ ê°’ì„ ë³µì‚¬+ë¶™ì—¬ë„£ê¸° í•˜ì—¬ ë‹¤ì‹œ í•œ ë²ˆ í…ŒìŠ¤íŠ¸í•œë‹¤. (ë¬´í•œ ìŠ¤í¬ë¡¤ë§ ê°€ëŠ¥í•œì§€ í…ŒìŠ¤íŠ¸)
    
    - ê°ì ë¡œì»¬ì˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ, ì§ì „ í…ŒìŠ¤íŠ¸ì˜ Response Body ê°€ì¥ ë§ˆì§€ë§‰ ë©”ì„¸ì§€ê°€ ë³´ë‚´ì§„ ì‹œì  ê·¸ ì „ì— ë³´ë‚´ì§„ ë©”ì„¸ì§€ë“¤ì´ ì˜ ì‘ë‹µë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
        
    - ì‚¬ì´ì— ëˆ„ë½ëœ ë°ì´í„°ëŠ” ì—†ëŠ”ì§€, ì¤‘ë³µëœ ë°ì´í„°ëŠ” ì—†ëŠ”ì§€ í™•ì¸í•œë‹¤.
    
        
    - Response Body ì „ë¬¸
        
        ```json
        {
          "isSuccess": true,
          "code": "COMMON200",
          "message": "ì„±ê³µì…ë‹ˆë‹¤.",
          "result": {
            "chatMessageList": [
              {
                "id": "67a5e8696afbb772f13ddd09",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸!!",
                "createdAt": "2025-02-07 20:03"
              },
              {
                "id": "67a5e3a66afbb772f13ddd06",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 19:42"
              },
              {
                "id": "67a5e36905104975c43f6a52",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 19:41"
              },
              {
                "id": "67a5cc9cd517cf33a98c56ee",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 18:04"
              },
              {
                "id": "67a5c8b8b410b43eb1b53e05",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 17:47"
              },
              {
                "id": "67a5c76f5bde7a70f5d1f9aa",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 17:42"
              },
              {
                "id": "67a5c5d95d7efd2b31f4d867",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 17:35"
              },
              {
                "id": "67a5c580259ac159692599f5",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸ì–´ê²Œì¸",
                "createdAt": "2025-02-07 17:34"
              },
              {
                "id": "67a5c21e133c67015b90453a",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸",
                "createdAt": "2025-02-07 17:19"
              },
              {
                "id": "67a5c188133c67015b904539",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "í…ŒìŠ¤íŠ¸",
                "createdAt": "2025-02-07 17:17"
              },
              {
                "id": "67a5b65587e46546c0c13893",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "ì•ˆë…•í•˜ì„¸ìš”! ì´ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.",
                "createdAt": "2025-02-07 16:29"
              },
              {
                "id": "67a5b6009526657ccb1879a3",
                "chatRoomId": 1,
                "senderId": 2,
                "receiverId": 1,
                "content": "ì•ˆë…•í•˜ì„¸ìš”! ì´ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.",
                "createdAt": "2025-02-07 16:28"
              }
            ],
            "hasNext": false,
            "lastMessageId": "67a5b6009526657ccb1879a3"
          }
        }
        ```