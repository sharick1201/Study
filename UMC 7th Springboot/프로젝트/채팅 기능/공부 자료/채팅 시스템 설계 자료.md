### 채팅 기능 기본 요구사항
채팅 서비스는 기본적으로 아래 기능을 요구한다.

1. **메세지 발신**
	* 클라이언트(사용자)가 애플리케이션을 통해 메시지를 발신한다. 이 메시지는 서버로 전송된다.
	* 서버는 클라이언트에서 수신된 메세지를 받아서 처리한다.
		
2. **수신자(recipient) 결정**
	* 서버는 메시지의 수신자를 결정한다.
		* 여기에서 말하는 수신자(recipient)란?
			* 메세지를 받을 사용자 또는 그룹
			* 수신자는 메세지의 내용에 따라 다를 수 있다.
				* 즉, 특정 사용자 ID를 기반으로 수신자를 설정하거나, 채팅룸 ID를 기반으로 수신자를 설정할 수도 있다.
3. **메세지 전달**
	* 수신자가 온라인 상태인지 확인한다.
		* 여기에서 말하는 온라인 상태란? 수신자에 해당하는 클라이언트가 서버에 연결되어 있고, 메세지를 받을 준비가 되어있는 상태
	* 수신자의 접속 상태에 따라 다음 로직이 달라진다.
		* 수신자가 온라인 상태라면, 서버는 해당 클라이언트에게 메세지를 즉시 전달한다.
		* 수신자가 오프라인 상태라면, 서버는 해당 메세지를 보관한다.
			* 이때 메세지는 수신자가 다시 온라인 상태가 될 때까지 대기한다.
			* 수신자가 온라인 상태로 돌아오면, 서버는 보관된 메세지를 해당 사용자에게 전달한다.

예컨대 사용자A가 사용자 B에게 메세지를 보낸다고 하자.
그럼 서버는 메세지를 수신하고, 수신자가 사용자 B임을 확인한다.
다음으로 서버는 사용자 B가 온라인 상태인지 오프라인 상태인지 확인한다.
온라인 상태라면, 메세지를 즉시 전달한다. 오프라인 상태라면, 사용자 B가 온라인 상태가 될 때까지 기다린다.

<span style="background:rgba(240, 107, 5, 0.2)">→ 그럼 제때제때 안 보는 사람이 많으면 많을수록 기다리는 데에 자원이 소비되고, 기능 저하가 일어나는 건가? 서버는 어떤 식으로 '대기'하는가?</span>
* [[서버는 '어떻게' 메세지를 대기시키는가?]]

### 요구사항 충족을 위한 네트워크 통신 프로토콜

상술한 채팅 기능 요구사항을 충족시키기 위하여, 채팅을 시작하고자 하는 클라이언트는 **네트워크 통신 프로토콜**을 사용하여 요청을 보낸다.


----


참고자료:
* 채팅 서비스 설계 시 고려점
	통신 아키텍쳐 측면: https://guti-coding.tistory.com/182
	서버 아키텍쳐 측면: https://guti-coding.tistory.com/190?category=1266186
	
* 채팅 시스템 설계 (『가상 면접 사례로 배우는 대규모 시스템 설계 기초』 기반 포스팅)
	https://azderica.github.io/til/docs/dev/system-design-interview/ch12/
	https://velog.io/@gidskql6671/채팅-시스템-설계
	https://jaeseo0519.tistory.com/410 (책 기반 + 자세한 추가 정보도 많음!)
	
* 카카오엔터의 채팅 플랫폼 구현기
	https://kakaoentertainment-tech.tistory.com/109
	
